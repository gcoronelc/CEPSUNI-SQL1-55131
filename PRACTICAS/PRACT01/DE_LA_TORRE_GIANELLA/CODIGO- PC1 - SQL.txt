-- =============================================
-- Creación de la Base de Datos
-- =============================================

USE master;
go

IF( EXISTS ( SELECT name FROM master.sys.databases WHERE name = 'OCTOPUS' ) )
BEGIN
	DROP DATABASE OCTOPUS;
END;
go

CREATE DATABASE OCTOPUS;
go


-- =============================================
-- Creció la Base de Datos
-- =============================================

use octopus;
go



CREATE TABLE CATEGORIA
( 
	IDCATEGORIA          integer IDENTITY ( 1,1 ) ,
	NOMBRE               varchar(50)  NOT NULL ,
	IDSUBCATEGORIA       varchar(20)  NULL 
)
go



ALTER TABLE CATEGORIA
	ADD CONSTRAINT XPKCATEGORIA PRIMARY KEY (IDCATEGORIA ASC)
go



CREATE TABLE CLIENTE
( 
	IDCLIENTE            integer IDENTITY ( 1,1 ) ,
	NOMBRE               varchar(100)  NOT NULL ,
	DIRECCION            varchar(100)  NOT NULL ,
	CIUDAD               varchar(50)  NOT NULL ,
	REGION               varchar(50)  NOT NULL ,
	PAIS                 varchar(20)  NOT NULL ,
	NUMERO               integer  NOT NULL ,
	EMAIL                varchar(40)  NOT NULL 
)
go



ALTER TABLE CLIENTE
	ADD CONSTRAINT XPKCLIENTE PRIMARY KEY (IDCLIENTE ASC)
go



CREATE TABLE COMPAÑIA_DE_ENVIO
( 
	IDCOMPAÑIA           varchar(10)  NOT NULL ,
	NOMBRE               varchar(20)  NOT NULL ,
	TELEFONO             integer  NOT NULL 
)
go



ALTER TABLE COMPAÑIA_DE_ENVIO
	ADD CONSTRAINT XPKCOMPAÑIA_DE_ENVIO PRIMARY KEY (IDCOMPAÑIA ASC)
go



CREATE TABLE DETALLE_DE_ORDEN
( 
	IDPRODUCTO           integer  NOT NULL ,
	IDPEDIDO             integer  NOT NULL ,
	PRECIOTOTAL          integer  NOT NULL ,
	METODOPAGO           varchar(50)  NOT NULL 
)
go



ALTER TABLE DETALLE_DE_ORDEN
	ADD CONSTRAINT XPKDETALLE_DE_ORDEN PRIMARY KEY (IDPRODUCTO ASC,IDPEDIDO ASC)
go



CREATE TABLE JEFE_DE_OPERACIONES
( 
	IDGERENTE            integer IDENTITY ( 1,1 ) ,
	NOMBRE               varchar(20)  NOT NULL ,
	REGION               varchar(20)  NOT NULL 
)
go



ALTER TABLE JEFE_DE_OPERACIONES
	ADD CONSTRAINT XPKJEFE_DE_OPERACIONES PRIMARY KEY (IDGERENTE ASC)
go



CREATE TABLE PEDIDO
( 
	IDPEDIDO             integer IDENTITY ( 1,1 ) ,
	IDCLIENTE            integer  NOT NULL ,
	IDGERENTE            integer  NOT NULL ,
	IDCOMPAÑIA           varchar(10)  NOT NULL ,
	FECHAORDEN           datetime  NOT NULL ,
	FORMADEENVIO         varchar(20)  NOT NULL ,
	COSTOENVIO           integer  NOT NULL ,
	FECHAENVIO           datetime  NOT NULL ,
	FECHALLEGADA         datetime  NOT NULL 
)
go



ALTER TABLE PEDIDO
	ADD CONSTRAINT XPKPEDIDO PRIMARY KEY (IDPEDIDO ASC)
go



CREATE TABLE PRODUCTO
( 
	IDPRODUCTO           integer  NOT NULL ,
	NOMBRE               varchar(100)  NOT NULL ,
	IDPROVEEDOR          integer  NULL ,
	IDCATEGORIA          integer  NULL ,
	CANTIDAD             integer  NOT NULL ,
	PRECIO               integer  NOT NULL ,
	UNIDADESENSTOCK      integer  NOT NULL 
)
go



ALTER TABLE PRODUCTO
	ADD CONSTRAINT XPKPRODUCTO PRIMARY KEY (IDPRODUCTO ASC)
go



CREATE TABLE PROVEEDOR
( 
	IDPROVEEDOR          integer IDENTITY ( 1,1 ) ,
	NOMBRE               varchar(50)  NOT NULL ,
	CONTACTO             varchar(50)  NOT NULL ,
	DIRECCION            varchar(100)  NOT NULL ,
	CIUDAD               varchar(20)  NOT NULL ,
	REGION               varchar(20)  NOT NULL ,
	PAIS                 varchar(20)  NOT NULL ,
	TELEFONO             integer  NOT NULL ,
	PAGINA               varchar(20)  NOT NULL 
)
go



ALTER TABLE PROVEEDOR
	ADD CONSTRAINT XPKPROVEEDOR PRIMARY KEY (IDPROVEEDOR ASC)
go



CREATE TABLE SUBCATEGORIA
( 
	IDSUBCATEGORIA       varchar(20)  NOT NULL ,
	NOMBRE               varchar(50)  NOT NULL 
)
go



ALTER TABLE SUBCATEGORIA
	ADD CONSTRAINT XPKSUBCATEGORIA PRIMARY KEY (IDSUBCATEGORIA ASC)
go




ALTER TABLE CATEGORIA
	ADD CONSTRAINT R_14 FOREIGN KEY (IDSUBCATEGORIA) REFERENCES SUBCATEGORIA(IDSUBCATEGORIA)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go




ALTER TABLE DETALLE_DE_ORDEN
	ADD CONSTRAINT R_10 FOREIGN KEY (IDPEDIDO) REFERENCES PEDIDO(IDPEDIDO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go




ALTER TABLE DETALLE_DE_ORDEN
	ADD CONSTRAINT R_9 FOREIGN KEY (IDPRODUCTO) REFERENCES PRODUCTO(IDPRODUCTO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go




ALTER TABLE PEDIDO
	ADD CONSTRAINT FK_PEDIDO_CLIENTE FOREIGN KEY (IDCLIENTE) REFERENCES CLIENTE(IDCLIENTE)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go




ALTER TABLE PEDIDO
	ADD CONSTRAINT FK_PEDIDO_JEFE FOREIGN KEY (IDGERENTE) REFERENCES JEFE_DE_OPERACIONES(IDGERENTE)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go




ALTER TABLE PEDIDO
	ADD CONSTRAINT FK_PEDIDO_COMPAÑIA FOREIGN KEY (IDCOMPAÑIA) REFERENCES COMPAÑIA_DE_ENVIO(IDCOMPAÑIA)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go




ALTER TABLE PRODUCTO
	ADD CONSTRAINT R_3 FOREIGN KEY (IDPROVEEDOR) REFERENCES PROVEEDOR(IDPROVEEDOR)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go




ALTER TABLE PRODUCTO
	ADD CONSTRAINT R_4 FOREIGN KEY (IDCATEGORIA) REFERENCES CATEGORIA(IDCATEGORIA)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
go

